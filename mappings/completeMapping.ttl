@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix christophe: <http://www.example.com/christophe#> .
@prefix nastya: <http://www.example.com/nastya#> .
@prefix thomas: <http://www.example.com/thomas#> .
@prefix lars: <http://www.example.com/lars#> .


### christophe mapping

<#PickupLocations>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.pickup_locations"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#pickupLocation_{address}" ; # should probably be a trimmed version of address
        rr:class christophe:PickupLocation ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:pickupAddress ;
        rr:objectMap [rr:column "address"] ;
    ] ;
.

<#DeliveryMethods>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.delivery_methods"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#delivery_method_{id}" ;
        rr:class christophe:DeliveryMethod ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:methodUUID ;
        rr:objectMap [rr:column "id"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:priority ;
        rr:objectMap [rr:column "priority"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:deliveryType ;
        rr:objectMap [rr:column "delivery type"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:address ;
        rr:objectMap [rr:column "address"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:has ;
        rr:objectMap [
            rr:parentTriplesMap <#PickupLocations> ;
            rr:joinCondition [
                rr:child "pickup_location" ;
                rr:parent "address" ;
            ] ;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate christophe:preferredBy ;
        rr:objectMap [
            rr:parentTriplesMap <#Customers> ;
            rr:joinCondition [
                rr:child "customer_id" ;
                rr:parent "email" ;
            ] ;
        ] ;
    ] ;
.

<#Purchases>
    a rr:TriplesMap ;
    
    rr:logicalTable [rr:tableName "webshop.orders"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#purchase_{id}" ;
        rr:class christophe:Purchase ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:purchaseUUID ;
        rr:objectMap [rr:column "id"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:date ;
        rr:objectMap [rr:column "date"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:totalPrice ;
        rr:objectMap [rr:column "total price"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:used ;
        rr:objectMap [
            rr:parentTriplesMap <#DeliveryMethods> ;
            rr:joinCondition [
                rr:child "delivery_method_id" ;
                rr:parent "id" ;
            ] ;
        ] ;
    ] ;
.

<#Customers>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.customers"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#{email}" ;
        rr:class christophe:Customer ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:phoneNumber ;
        rr:objectMap [rr:column "phone number"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:fullName ;
        rr:objectMap [rr:column "full name"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:email ;
        rr:objectMap [rr:column "email"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:hasPreferred ;
        rr:objectMap [
            rr:parentTriplesMap <#DeliveryMethods> ;
            rr:joinCondition [
                rr:child "email" ;
                rr:parent "customer_id" ;
            ];
        ];
    ];
.

<#CustProducts>
    a rr:TriplesMap ;

    rr:logicalTable [rr:sqlQuery """SELECT DISTINCT products as id from webshop.order_products"""] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#product_{id}" ;
        rr:class christophe:Product ;
    ] ;
# Could not infer the type of id1
#    rr:predicateObjectMap [
#        rr:predicate christophe:productUUID ;
#        rr:objectMap [rr:column "id"] ;
#    ] ;
.

<#PurchasesContainProducts> 
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.order_products"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/christophe#purchase_{order}" ;
#        rr:class christophe:Purchase ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate christophe:contains ;
        rr:objectMap [ rr:template "http://www.example.com/christophe#product_{products}"] ;
    ] ;
.



### nastya mapping

<#Categories>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.categories"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/nastya#category_{cat_name}" ;
        rr:class nastya:Category ;
    ] ;

        rr:predicateObjectMap [
        rr:predicate nastya:cat_name ;
        rr:objectMap [rr:column "cat_name"] ;
    ] ;
.

<#SubCategories>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.subcategories"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/nastya#subcategory_{subcat_name}" ;
        rr:class nastya:SubCategory ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:subcat_name ;
        rr:objectMap [rr:column "subcat_name"] ;
    ] ;

    #Foreign key
    rr:predicateObjectMap [
        rr:predicate nastya:on ;
        rr:objectMap [
            rr:parentTriplesMap <#Categories>;
   
            rr:joinCondition [
                rr:child "fk_category" ;
                rr:parent "cat_name" ;
            ];
        ];
    ];
.

<#Products>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.products"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/nastya#product_{prod_id}" ;
        rr:class nastya:Product ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:prod_id ;
        rr:objectMap [rr:column "prod_id"]
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:name ;
        rr:objectMap [rr:column "prod_name"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate nastya:description ;
        rr:objectMap [rr:column "description"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate nastya:price ;
        rr:objectMap [rr:column "price"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate nastya:brand ;
        rr:objectMap [rr:column "brand"] ;
    ] ;

    #Foreign key
    rr:predicateObjectMap [
        rr:predicate nastya:belongsTo ;
        rr:objectMap [
            rr:parentTriplesMap <#SubCategories>;

            rr:joinCondition [
                rr:child "fk_subcategory" ;
                rr:parent "subcat_name" ;
            ];
        ];
    ];
.

<#Reviews>
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.reviews"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/nastya#review_{review_id}" ;
        rr:class nastya:Review ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:review_id ;
        rr:objectMap [rr:column "review_id"] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:deleted ;
        rr:objectMap [rr:column "deleted"] ;
    ] ;

#    rr:predicateObjectMap [
#        rr:predicate nastya:location ;
#        rr:objectMap [rr:column "location"] ;
#    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:date ;
        rr:objectMap [rr:column "timestamp"] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:title ;
        rr:objectMap [rr:column "title"] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:text ;
        rr:objectMap [rr:column "text"] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:num_stars ;
        rr:objectMap [rr:column "num_stars"] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate nastya:username ;
        rr:objectMap [rr:column "username"] ;
    ] ;


    #Foreign key
    rr:predicateObjectMap [
        rr:predicate nastya:on ;
        rr:objectMap [
            rr:parentTriplesMap  <#Products>;
            
            rr:joinCondition [
                rr:child "fk_product" ;
                rr:parent "prod_id" ;
            ];
        ];
    ];
.



### thomas mapping

thomas:ProductTripleMap
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.thomas_Product"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#product_{ProductUUID}";
        rr:class thomas:Product
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:productUUID ;
        rr:objectMap [rr:column "ProductUUID"]
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:price ;
        rr:objectMap [rr:column "Price"]
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:volume ;
        rr:objectMap [rr:column "Volume"]
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:commision ;
        rr:objectMap [rr:column "Commision"]
    ].

thomas:WarehouseTripleMap
    a rr:TriplesMap ;

    rr:logicalTable [rr:sqlQuery """select replace(Address, ' ', '') as ID, Address, SpaceLimit 
                                    from webshop.Warehouse"""] ;
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#warehouse_{ID}";
        rr:class thomas:Product ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:address ;
        rr:objectMap [rr:column "Address"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:spaceLimit ;
        rr:objectMap [rr:column "SpaceLimit"] ;
    ] .

thomas:DeliveryTripleMap
    a rr:TriplesMap ;

    rr:logicalTable [rr:tableName "webshop.Delivery"] ;
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#delivery_{DeliveryUUID}";
        rr:class thomas:Product
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:deliveryUUID ;
        rr:objectMap [rr:column "DeliveryUUID"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:isOrder ;
        rr:objectMap [rr:column "IsOrder"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:destinationAddress ;
        rr:objectMap [rr:column "DestinationAddress"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:deliveryService ;
        rr:objectMap [rr:column "DeliveryService"] ;
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:transportCosts ;
        rr:objectMap [rr:column "TransportCosts"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:departureTime ;
        rr:objectMap [rr:column "DepartureTime"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:arrivalTime ;
        rr:objectMap [rr:column "ArrivalTime"] ;
    ].

thomas:EmployeeTripleMap
    a rr:TriplesMap ;

    rr:logicalTable [rr:sqlQuery """select replace(FullName, ' ', '') as ID, * 
                                    from webshop.Employee"""] ;
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#employee_{ID}";
        rr:class thomas:Product ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:fullName ;
        rr:objectMap [rr:column "FullName"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:salary ;
        rr:objectMap [rr:column "HourlyRate"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:worksAt ;
        rr:objectMap [
            rr:parentTriplesMap thomas:WarehouseTripleMap;
            rr:joinCondition [
                rr:child "Address" ;
                rr:parent "Address" ;
            ] ;
        ] ;
    ].

thomas:stockTripleMap
    a rr:TriplesMap;

    rr:logicalTable [rr:sqlQuery """select replace(Address, ' ', '') as ConcatAddress, * 
                                    from webshop.Product_Warehouse"""];
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#stock_{ProductUUID}_{ConcatAddress}";
        rr:class thomas:Stock
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:productStock;
        rr:objectMap [rr:column "ProductStock"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:stockOfProduct ;
        rr:objectMap [
            rr:parentTriplesMap thomas:ProductTripleMap;
            rr:joinCondition [
                rr:child "ProductUUID" ;
                rr:parent "ProductUUID" ;
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:stockOfWarehouse ;
        rr:objectMap [
            rr:parentTriplesMap thomas:WarehouseTripleMap;
            rr:joinCondition [
                rr:child "Address" ;
                rr:parent "Address" ;
            ];
        ];
    ].


thomas:DeliverySizeTripleMap
    a rr:TriplesMap;

    rr:logicalTable [rr:tableName "webshop.Product_Delivery"];

    rr:subjectMap [
        rr:template "http://www.example.com/thomas#deliverySize_{ProductUUID}_{DeliveryUUID}";
        rr:class thomas:DeliverySize
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:productAmount;
        rr:objectMap [rr:column "ProductAmount"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:deliverySizeOfProduct ;
        rr:objectMap [
            rr:parentTriplesMap thomas:ProductTripleMap;
            rr:joinCondition [
                rr:child "ProductUUID" ;
                rr:parent "ProductUUID" ;
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:deliverySizeOfDelivery ;
        rr:objectMap [
            rr:parentTriplesMap thomas:DeliveryTripleMap;
            rr:joinCondition [
                rr:child "DeliveryUUID" ;
                rr:parent "DeliveryUUID" ;
            ];
        ];
    ].


thomas:ScheduleTripleMap
    a rr:TriplesMap;

    rr:logicalTable [rr:sqlQuery """select replace(FullName, ' ', '') as ConcatName, * 
                                    from webshop.Delivery_Employee"""];
    rr:subjectMap [
        rr:template "http://www.example.com/thomas#schedule_{DeliveryUUID}_{ConcatName}";
        rr:class thomas:Schedule ;
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:hoursWorked;
        rr:objectMap [rr:column "HoursWorked"] ;
    ] ;
    rr:predicateObjectMap [
        rr:predicate thomas:scheduleOfEmployee;
        rr:objectMap [
            rr:parentTriplesMap thomas:EmployeeTripleMap;
            rr:joinCondition [
                rr:child "FullName";
                rr:parent "FullName" ;
            ] ;
        ] ;
    ];
    rr:predicateObjectMap [
        rr:predicate thomas:scheduleOfDelivery;
        rr:objectMap [
            rr:parentTriplesMap thomas:DeliveryTripleMap;
            rr:joinCondition [
                rr:child "DeliveryUUID";
                rr:parent "DeliveryUUID" ;
            ] ;
        ] ;
    ].


### lars mapping

<#Supplier>
    a rr:TriplesMap ; 

    rr:logicalTable [ rr:tableName "webshop.Supplier" ] ; 

    rr:subjectMap [
        rr:template "http://www.example.com/lars#supplier_{supplier_id}" ; 
        rr:class lars:Supplier ; 
    ] ;

    rr:predicateObjectMap [ 
        rr:predicate lars:semail ;
        rr:objectMap [ rr:column "email" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:supplierID ;
        rr:objectMap [ rr:column "supplier_id" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:phone ; 
        rr:objectMap [ rr:column "phone" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:sname ; 
        rr:objectMap [ rr:column "name" ] ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:supplies ;
        rr:objectMap [
            rr:parentTriplesMap <#Product> ;
            rr:joinCondition [
                rr:child "supplier_id" ;
                rr:parent "product_id" ;
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:provides ;
        rr:objectMap [
            rr:parentTriplesMap <#LoyaltyCard> ;
            rr:joinCondition [
                rr:child "supplier_id" ;
                rr:parent "card_id" ;
            ] ;
        ] ;
    ] ;
.

<#LoyaltyCard>
    a rr:TriplesMap ;

    rr:logicalTable [ rr:tableName "webshop.\"Loyalty Card\"" ] ;

    rr:subjectMap [
        rr:template "http://www.example.com/lars#loyaltycard_{card_id}" ;
        rr:class lars:LoyaltyCard ;
    ] ;

    rr:predicateObjectMap [ 
        rr:predicate lars:loyaltyCardID ; 
        rr:objectMap [ rr:column "card_id" ] ; 
    ] ;

    rr:predicateObjectMap [ 
        rr:predicate lars:orderCount ; 
        rr:objectMap [ rr:column "order_counter" ] ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:belongsTo ;
        rr:objectMap [
            rr:parentTriplesMap <#User> ;
            rr:joinCondition [
                rr:child "card_id" ;
                rr:parent "user_id" ;
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:isProvidedBy ;
        rr:objectMap [
            rr:parentTriplesMap <#Supplier> ;
            rr:joinCondition [
                rr:child "card_id" ;
                rr:parent "supplier_id" ;
            ] ;
        ] ;
    ] ;
.

<#Order>
    a rr:TriplesMap ; 

    rr:logicalTable [ rr:tableName "webshop.\"Order\"" ] ; 

    rr:subjectMap [
        rr:template "http://www.example.com/lars#order_{order_id}" ;
        rr:class lars:Order ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:orderID ;
        rr:objectMap [ rr:column "order_id" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:totalPrice ;
        rr:objectMap [ rr:column "total_price" ] ; 
    ] ; 

    rr:predicateObjectMap [
        rr:predicate lars:contains ;
        rr:objectMap [
            rr:parentTriplesMap <#Product> ;
            rr:joinCondition [
                rr:child "order_id" ;
                rr:parent "product_id" ; 
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:isPlacedBy ;
        rr:objectMap [
            rr:parentTriplesMap <#User> ;
            rr:joinCondition [
                rr:child "order_id" ;
                rr:parent "user_id" ;
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:isReturnedBy ;
        rr:objectMap [
            rr:parentTriplesMap <#User> ;
            rr:joinCondition [
                rr:child "order_id" ;
                rr:parent "user_id" ;
            ] ;
        ] ;
    ] ;
.

<#Product> 
    a rr:TriplesMap ;

    rr:logicalTable [ rr:tableName "webshop.lars_Product" ] ; 

    rr:subjectMap [
        rr:template "http://www.example.com/lars#product_{product_id}" ; 
        rr:class lars:Product ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:productID ; 
        rr:objectMap [ rr:column "product_id" ] ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:productName ; 
        rr:objectMap [ rr:column "name" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:isAddedTo ;
        rr:objectMap [
            rr:parentTriplesMap <#Order> ;
            rr:joinCondition [
                rr:child "product_id" ;
                rr:parent "order_id" ;
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:isSuppliedBy ;
        rr:objectMap [
            rr:parentTriplesMap <#Supplier> ;
            rr:joinCondition [
                rr:child "product_id" ;
                rr:parent "supplier_id" ;
            ] ;
        ] ;
    ] ;
.

<#Rating>
    a rr:TriplesMap ;

    rr:logicalTable [ rr:tableName "webshop.Rating" ] ;

    rr:subjectMap [
        rr:template "http://www.example.com/lars#rating_{rating_id}" ;
        rr:class lars:Rating ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:ratingID ;
        rr:objectMap [ rr:column "rating_id" ] ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:ratingText ;
        rr:objectMap [ rr:column "text" ] ; 
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:stars ; 
        rr:objectMap [ rr:column "rating" ] ;
    ] ;
.

<#User>
    a rr:TriplesMap ; 

    rr:logicalTable [ rr:tableName "webshop.\"User\"" ] ; 

    rr:subjectMap [
        rr:template "http://www.example.com/lars#user_{user_id}" ;
        rr:class lars:User ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:userID ; 
        rr:objectMap [ rr:column "user_id" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:userEmail ;
        rr:objectMap [ rr:column "email" ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:userAddress ;
        rr:objectMap [ rr:column "address" ] ;
    ] ; 

    rr:predicateObjectMap [
        rr:predicate lars:owns ;
        rr:objectMap [
            rr:parentTriplesMap <#LoyaltyCard> ;
            rr:joinCondition [
                rr:child "user_id" ; 
                rr:parent "card_id" ; 
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:places ;
        rr:objectMap [
            rr:parentTriplesMap <#Order> ;
            rr:joinCondition [
                rr:child "user_id" ;
                rr:parent "order_id" ;
            ] ;
        ] ;
    ] ;

    rr:predicateObjectMap [
        rr:predicate lars:returns ;
        rr:objectMap [
            rr:parentTriplesMap <#Order> ;
            rr:joinCondition [
                rr:child "user_id" ;
                rr:parent "order_id" ;
            ] ;
        ] ;
    ] ;
.

<#Review>
    a rr:TriplesMap ;

    rr:logicalTable [ rr:sqlQuery """SELECT DISTINCT rating_id FROM webshop.Rating r INNER JOIN webshop.Supplier s ON r.supplier_id_fkey = s.supplier_id INNER JOIN webshop.\"User\" u ON r.user_id_fkey = u.user_id """ ] ;

    rr:subjectMap [
        rr:template "http://www.example.com/lars#review_{rating_id}"; 
        rr:class lars:Review ;
    ] ;
.